<html>
<head>
    <title>Holyrood Tweets per second in last minute</title>
    <script src='/socket.io/socket.io.js'></script>
    <script src='/scripts/d3.v3.min.js'></script>
    <script src="/scripts/cubism.v1.min.js"></script>




    <style>
      @import url(/stylesheets/cubestyle.css);
        #map { width: 800px; height: 600px; }
        body { font: 16px/1.4 "Helvetica Neue", Arial, sans-serif; }
        .ghbtns { position: relative; top: 4px; margin-left: 5px; }
        a { color: #0077ff; }
        .party {background-color: #ffffff;}
    </style>

</head>
<body>
<div id="top">
<p>
    Holyrood 2016
    <span id='totals'> </span>


</p>
<p>
  <span id='snp'> </span><span id='tor'> </span><span id='lab'> </span><span id='lib'> </span><span id='gre'> </span><span id='uki'> </span>
  <span id='snp1'> </span><span id='tor1'> </span><span id='lab1'> </span><span id='lib1'> </span><span id='gre1'> </span><span id='uki1'> </span>

</p>

<div id="tweets"></div>
</div>
<div id="ingraph" class ="party" ></div>
<div id="outgraph" class ="party" ></div>
<script>
function random(name) {
  var value = 0,
      values = [],
      i = 0,
      last;
      return context.metric(function(start, stop, step, callback) {
    start = +start, stop = +stop;
    if (isNaN(last)) last = start;
    while (last < stop) {
      last += step;
      //value = Math.max(-10, Math.min(10, value + .8 * Math.random() - .4 + .2 * Math.cos(i += .2)));
      if(name=="in"){
        values.push(snpc);
        snpc =0;
        //if(snpc>0){snpc--};
      }
      if(name=="out"){
        values.push(labc);
        labc=0;
        //if(labc>0){labc--};
      }
    }
    callback(null, values = values.slice((start - stop) / step));
  }, name);
}
var snpl=0;
var labl=0;
var libl=0;
var ukil=0;
var grel=0;
var torl=0;


var context = cubism.context()
    .serverDelay(0)
    .clientDelay(0)
    .step(62.5)
    .size(960);

    var snp = random("in");
    var lab = random("out");



var inc=0;
var outc=0;



var dataSnp = [];

d3.select("#ingraph").call(function(div)
{

  div.datum(in);
  inc =0;

  div.append("div")
    .attr("class", "horizon")
    .call(context.horizon()
      .height(80)
      .colors(["#bdd7e7","#FFFF4C","#FFFF00"])
      .title("SNP")
      .extent([0, 10]));
});
d3.select("#outgraph").call(function(div)
{

  div.datum(out);
  outc =0;

  div.append("div")
    .attr("class", "horizon")
    .call(context.horizon()
      .height(80)
      .colors(["#bdd7e7","#FF564C","#CC0B00"])
      .title("Labour")
      .extent([0, 10]));
});


var socket = io();


    socket.on('status', function(data) {
        //console.log(data.count);
        //console.log(data[0]);
        document.getElementById('in1').innerHTML = "SNP: "+data.allcounts.count.in+" ";
        document.getElementById('out1').innerHTML = "Labour: "+data.allcounts.count.out" ";

    });
    socket.on('tweet', function(data) {
        addMessage(data.tweet);
        if(data.ineu=='true'){
          inLayer.addLatLng(latlng);
        }
        if(data.outeu=='true'){
          outLayer.addLatLng(latlng);
        }
    });

    //socket.on('tweet', function(data) {
    //    console.log(data);

    //});
    socket.on('error', console.error.bind(console));
    socket.on('message', console.log.bind(console));
    socket.on('data', console.log.bind(console));

    function addMessage(tweet) {
      document.getElementById('tweets').innerHTML =
      "<h3>"+tweet+"</h3>"

        //var text = document.createTextNode(JSON.stringify(message));
            //console.log(message);
    }

    //$(".party").animate({ 'zoom':  }, 0);









</script>
<script src="https://code.jquery.com/jquery-2.2.2.min.js"></script>
</body>
</html>
